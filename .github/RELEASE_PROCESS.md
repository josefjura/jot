# Release Process

This document describes how to create a new release of Jot.

## Overview

Jot uses automated CI/CD workflows for releases:
- **CI**: Runs on every PR and push to main (tests, clippy, rustfmt, version checks)
- **Release**: Triggered by pushing a git tag, builds cross-platform binaries and creates GitHub Release

## Creating a Release

### 1. Update Version Numbers

Update the version in the appropriate `Cargo.toml` files:

```bash
# For CLI changes
vim cli/Cargo.toml  # Update version field

# For server changes
vim server/Cargo.toml  # Update version field

# Update workspace lockfile
cargo update -w
```

### 2. Update CHANGELOG

Edit `CHANGELOG.md`:
- Move items from `[Unreleased]` to a new version section
- Add release date
- Follow [Keep a Changelog](https://keepachangelog.com/) format

Example:
```markdown
## [0.2.1] - 2025-01-19

### Added
- New feature X

### Fixed
- Bug Y
```

### 3. Commit and Push

```bash
git add -A
git commit -m "Release v0.2.1"
git push origin main
```

### 4. Create and Push Tag

```bash
# Create annotated tag
git tag -a v0.2.1 -m "Release v0.2.1"

# Push tag to trigger release workflow
git push origin v0.2.1
```

### 5. Monitor Release Workflow

1. Go to: https://github.com/josefjura/jot/actions
2. Watch the "Release" workflow run
3. Wait for all builds to complete (~10-15 minutes)

### 6. Verify GitHub Release

Once the workflow completes:
1. Go to: https://github.com/josefjura/jot/releases
2. Verify the release was created with:
   - Changelog content
   - Binary artifacts for all platforms
   - SHA256 checksums

## Release Artifacts

The release workflow builds binaries for:
- **Linux**: x86_64, aarch64 (GNU libc)
- **macOS**: x86_64 (Intel), aarch64 (Apple Silicon)
- **Windows**: x86_64 (MSVC)

Each platform gets:
- Compressed archive (.tar.gz or .zip)
- SHA256 checksum file

## Version Numbering

Follow [Semantic Versioning](https://semver.org/):
- **MAJOR** (x.0.0): Breaking changes
- **MINOR** (0.x.0): New features, backward compatible
- **PATCH** (0.0.x): Bug fixes, backward compatible

## PR Version Check

The CI workflow enforces version bumps on PRs:
- Every PR must bump the version in at least one component
- To skip (for docs/chore changes), add the `skip-version-check` label

## Troubleshooting

### Release workflow fails

1. Check the Actions tab for error logs
2. Common issues:
   - Compilation errors: Fix code and push new tag
   - Missing secrets: Verify `GITHUB_TOKEN` permissions

### Tag already exists

If you need to re-release:
```bash
# Delete local tag
git tag -d v0.2.1

# Delete remote tag
git push origin :refs/tags/v0.2.1

# Create new tag and push
git tag -a v0.2.1 -m "Release v0.2.1"
git push origin v0.2.1
```

### Version check fails on PR

Either:
1. Bump the version in `cli/Cargo.toml` or `server/Cargo.toml`
2. Add the `skip-version-check` label to the PR (for non-feature changes)

## CI Configuration

### Workflows

- `.github/workflows/ci.yml`: Continuous integration (tests, lints, checks)
- `.github/workflows/release.yml`: Release automation (generated by cargo-dist)

### cargo-dist Configuration

Configuration is in `dist-workspace.toml`:
- Target platforms
- Installer options
- Release settings

To regenerate release workflow after config changes:
```bash
cargo dist init
```
